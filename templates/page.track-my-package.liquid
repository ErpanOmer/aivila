<style>
/* 简洁的 tracking 区块样式 */
.aiv-tracking-info{
  padding: 12px 0;
  border-radius: 10px;
  margin: 10px 0;
  font-size: 14px;
}
.aiv-tracking-info .tn{ font-weight:700; margin-bottom:15px;font-size: 18px;}
.aiv-tracking-info .timeline{ display:flex; flex-direction:column; gap:30px; }
.aiv-tracking-info .timeline-item{ display:flex; flex-direction: column;gap:4px; align-items:flex-start; }
.aiv-tracking-info .ti-time{ min-width:120px; font-size: 18px;font-weight: 500; }
.aiv-tracking-info .ti-desc{ flex:1; font-size:14px; }
@media (max-width:768px){
  .aiv-tracking-info{ font-size:13px; padding:10px; }
  .aiv-tracking-info .tn{ font-size: 16px;}
}
</style>

{{ 'jquery.js' |  asset_url | script_tag }}
<div style="min-height: 100vh;display: flex;align-items: center;justify-content: center;" class="er-overflow-x-hidden er-py-20 er-w-full">
  <div class="centeral-content er-flex er-flex-col er-items-center mb:er-mx-0 mb:er-w-full mb:er-px-6">
  <h1 class="text-size36 er-text-center er-my-16 mb:er-text-5xl">Track My Package</h1>
  <form
    class="er-flex er-flex-col er-items-start er-space-y-12 mb:er-space-y-8 er-w-full er-max-w-2xl er-mx-auto"
    method="post"
    action="/contact#contact_form"
    id="track_form"
  >
    <div class="er-flex er-flex-col er-items-start er-space-y-3 mb:er-space-y-2 er-w-full er-max-w-2xl">
      <label for="email"
        ><b>Email <sup class="er-text-primary">*</sup></b></label
      >
      <input
        class="mb:er-text-2xl er-box-border er-font-base er-w-full er-border-2 er-border-dark/30 placeholder:er-text-black/15 er-border-solid er-rounded-xl er-text-dark/85 er-text-3xl er-p-4 focus:er-border-primary/80 focus-visible:er-border-primary/80 focus:er-ring-primary focus:er-shadow-primary"
        type="email"
        id="user_email"
        name="user_email"
        placeholder="Enter your email"
        required
      >
    </div>
    <div class="tips er-text-primary text-size16 mb:er-text-2xl er-hidden">Sorry😔, No order information found, please check and try again!</div>
    <button class="er-button er-w-full" type="submit">Submit</button>
  </form>
</div>
</div>

<script type="module">
  // 清除旧的物流信息
  function clearTrackingBlock(){
    $('.aiv-tracking-info').remove();
  }

  // 渲染 r（响应）中的 tracking 信息，插入到按钮上方
  function renderTracking(r){
    clearTrackingBlock();

    if(!(r && r.data)) return;

    var data = r.data || {};
    var tn = data.tracking_number || '';
    var details = Array.isArray(data.details) ? data.details : [];

    var $wrap = $('<div>').addClass('aiv-tracking-info');
    if(tn) $wrap.append($('<div>').addClass('tn').text('Tracking Number: ' + tn));

    var $timeline = $('<div>').addClass('timeline');
    if(details.length === 0){
      $timeline.append($('<div>').addClass('timeline-item').append(
        $('<div>').addClass('ti-desc').text('No tracking details available.')
      ));
    } else {
      details.forEach(function(it){
        var time = it.time || '';
        var desc = it.description || '';
        var $item = $('<div>').addClass('timeline-item');
        $item.append($('<div>').addClass('ti-time').text(time));
        $item.append($('<div>').addClass('ti-desc').text(desc));
        $timeline.append($item);
      });
    }
    $wrap.append($timeline);

    // 插入到表单中：在 Submit 按钮之前
    $('#track_form button[type="submit"]').before($wrap);
  }


  $('#track_form').submit(function (e) {
    $('.tips').hide()
    clearTrackingBlock();
    const queryString = $('#track_form').serialize();

    fetch(`http://api-test.newurtopia.com/aivela-api/third_party/order_tracking?${queryString}`).then(r => r.json()).then(r => {
      console.log(r)

     if (!r.data) {
        // 没有数据，显示提示文案（后端自带 message 则使用）
        $('.tips').show().text(r.message || 'Sorry😔, No order information found, please check and try again!');
        return;
      }

      // 有数据时渲染到按钮上方
      renderTracking(r);
    }).catch((e) => {
      console.log(e);
      $('.tips').show()
    })

    
    return false;
  });
</script>
